# Описание API

Все вызовы API принимают и отдают JSON-данные.

## Для администратора
Все вызовы для администратора требуют базовую HTTP-авторизацию.

#### GET /api/survey/
Получение списка всех опросов. Тело ответа:
```
[
    {
        "id",             # Число
        "title",          # Строка
        "description",    # Строка
        "start_date":,    # Строка YYYY-MM-DD
        "end_date":       # Строка YYYY-MM-DD
    },
    ...
]
```

#### POST /api/survey/
Создание нового опроса. 
Тело запроса:
```
{
"survey":
    {
    title,           # Строка. Заголовок опроса
    description,     # Строка. Описание опроса
    start_date,      # Строка YYYY-MM-DD. Дата начала опроса. Должна быть старше или равна текущей дате
    end_date         # Строка YYYY-MM-DD. Дата окончания опроса. Должна быть больше или равна текущей дате, больше даты начала
    }
}
```
Тело ответа:
```
{
    "id",             # Число
    "title",          # Строка
    "description",    # Строка
    "start_date":,    # Строка YYYY-MM-DD
    "end_date":       # Строка YYYY-MM-DD
}
```

#### GET /api/survey/(survey_id)
Где survey_id - ID ранее созданного опроса
Получение информации о ранне созданном опросе. Тело ответа:
```
{
    "id",             # Число
    "title",          # Строка
    "description",    # Строка
    "start_date":,    # Строка YYYY-MM-DD
    "end_date":       # Строка YYYY-MM-DD
}
```

#### PATCH /api/survey/(survey_id)
Где survey_id - ID ранее созданного опроса
Редактирование опроса. Поля опциональные
Тело запроса:
```
{
"survey":
    {
    title,           # Строка. Заголовок опроса
    description,     # Строка. Описание опроса
    end_date         # Строка YYYY-MM-DD. Дата окончания опроса. Должна быть больше или равна текущей дате, больше даты начала
    }
}
```
Тело ответа:
```
{
    "id",             # Число
    "title",          # Строка
    "description",    # Строка
    "start_date":,    # Строка YYYY-MM-DD
    "end_date":       # Строка YYYY-MM-DD
}
```

#### DELETE /api/survey/(survey_id)
Где survey_id - ID ранее созданного опроса
Удаление опроса.

#### POST /api/survey/(survey_id)/questions/
Где survey_id - ID ранее созданного опроса
Создание вопросов с ответами в указанном опросе.
Тело запроса:
```
{"questioninsurveys":
	[		              # Список вопросов
		{
		"question_type",  # Строка. Тип вопроса ('Т'-текст, 'O'-один вариант выбора, 'M'-несколько вариантов выбора)
		"question_text",  # Строка. Текст вопроса
		"answeroptions":  # Список ответов
			[
				{"text"}, # Строка. Текст ответа
				...
			]
		},
	...
	]		
}
```
Тело ответа:
```
[
    {
        "id",                   # Число. ID - вопроса
        "survey",               # Число. ID - опроса
        "question_type",        # Строка. Тип вопроса ('Т'-текст, 'O'-один вариант выбора, 'M'-несколько вариантов выбора)
        "question_text",        # Строка. Текст вопроса
        "answeroptions":        # Список
        [
            {
                "id",           # Число. ID-ответа
                "question",     # Число. ID-вопроса
                "index",        # Число. Индекс ответа
                "text"          # Строка. Текст ответа
            }
            ...
        ]
    }
    ...
]
```

#### GET /api/survey/(survey_id)/questions/
Где survey_id - ID ранее созданного опроса
Получение информации о вопросах в опросе и вариантов ответов на них.
Тело ответа:
```
[
    {
        "id",                   # Число. ID - вопроса
        "survey",               # Число. ID - опроса
        "question_type",        # Строка. Тип вопроса ('Т'-текст, 'O'-один вариант выбора, 'M'-несколько вариантов выбора)
        "question_text",        # Строка. Текст вопроса
        "answeroptions":        # Список
        [
            {
                "id",           # Число. ID-ответа
                "question",     # Число. ID-вопроса
                "index",        # Число. Индекс ответа
                "text"          # Строка. Текст ответа
            }
            ...
        ]
    }
    ...
]
```

#### GET /api/survey/(survey_id)/questions/(question_id)
survey_id - ID ранее созданного опроса
question_id - ID ранее созданного вопроса
Получение информации о вопросе, по указанному ID опроса и ID вопроса, с вариантами ответов.
Тело ответа:
```
{
    "id",                   # Число. ID - вопроса
    "survey",               # Число. ID - опроса
    "question_type",        # Строка. Тип вопроса ('Т'-текст, 'O'-один вариант выбора, 'M'-несколько вариантов выбора)
    "question_text",        # Строка. Текст вопроса
    "answeroptions":        # Список
    [
        {
            "id",           # Число. ID-ответа
            "question",     # Число. ID-вопроса
            "index",        # Число. Индекс ответа
            "text"          # Строка. Текст ответа
        }
        ...
    ]
}
```

#### DELETE /api/survey/(survey_id)/questions/(question_id)
survey_id - ID ранее созданного опроса
question_id - ID ранее созданного вопроса
Удаление вопроса из опроса.

#### PATCH /api/survey/(survey_id)/questions/(question_id)
survey_id - ID ранее созданного опроса
question_id - ID ранее созданного вопроса
Изменение существующего вопроса. Тело запроса (все поля опциональные):
Тело запроса:
```
{"questioninsurveys":
    {
    "question_type",  # Строка. Тип вопроса ('Т'-текст, 'O'-один вариант выбора, 'M'-несколько вариантов выбора)
    "question_text",  # Строка. Текст вопроса
    "answeroptions":  # Список ответов
    	[
    		{"text"}, # Строка. Текст ответа
    		...
    	]
    }
}
```
Тело ответа:
```
{
    "id",                   # Число. ID - вопроса
    "survey",               # Число. ID - опроса
    "question_type",        # Строка. Тип вопроса ('Т'-текст, 'O'-один вариант выбора, 'M'-несколько вариантов выбора)
    "question_text",        # Строка. Текст вопроса
    "answeroptions":        # Список
    [
        {
            "id",           # Число. ID-ответа
            "question",     # Число. ID-вопроса
            "index",        # Число. Индекс ответа
            "text"          # Строка. Текст ответа
        }
        ...
    ]
}
```
----
##  Для пользователя

#### GET /api
Получить список активных опросов. 
Тело ответа:
```
[
    {
        "id",             # Число
        "title",          # Строка
        "description",    # Строка
        "start_date":,    # Строка YYYY-MM-DD
        "end_date":       # Строка YYYY-MM-DD
    },
    ...
]
```

#### GET /api/(survey_id)
survey_id - ID активного опроса
Тело ответа:
```
{
    "survey": {
        "id",             # Число
        "title",          # Строка
        "description",    # Строка
        "start_date":,    # Строка YYYY-MM-DD
        "end_date":       # Строка YYYY-MM-DD
    },
    "questioninsurveys": 
    [
        {
            "id",                   # Число. ID - вопроса
            "survey",               # Число. ID - опроса
            "question_type",        # Строка. Тип вопроса ('Т'-текст, 'O'-один вариант выбора, 'M'-несколько вариантов выбора)
            "question_text",        # Строка. Текст вопроса
            "answeroptions":        # Список
            [
                {
                    "id",           # Число. ID-ответа
                    "question",     # Число. ID-вопроса
                    "index",        # Число. Индекс ответа
                    "text"          # Строка. Текст ответа
                }
                ...
            ]
        }
    ...
    ]
}
```

#### GET /api/results/(user_id)
user_id - ID пользователя
Пройденные опросы с ответами
```
[
    {
        "id_survey", # Число. ID - опроса
        "user_id",   # Число. ID - пользователя
        "results":   # Список. Вопросы и ответы на них
		[
            {
                "question_type", # Строка. Тип вопроса
                "question_text", # Строка. Текст вопроса
                "answer_text":   # Строка. Ответы на вопрос
                    			 #	Для ответов с выриантов выбора строка вида ["One","Two"]
            }
			...
        ]
    },
    ...
]
```
#### GET /api/results/(user_id)/survey/(survey_id)
user_id - ID пользователя
survey_id - ID активного опроса
Результаты опроса с указанным ID с ответами
```
[
    {
        "id_survey", # Число. ID - опроса
        "user_id",   # Число. ID - пользователя
        "results":   # Список. Вопросы и ответы на них
		[
            {
                "question_type", # Строка. Тип вопроса
                "question_text", # Строка. Текст вопроса
                "answer_text":   # Строка. Ответы на вопрос
                    			 #	Для ответов с выриантов выбора строка вида ["One","Two"]
            }
			...
        ]
    },
    ...
]
```
#### POST /api/results/(user_id)/survey/(survey_id)
user_id - ID пользователя
survey_id - ID активного опроса
Отправить ответы по опросу
Тело запроса:
```
{
	"id_survey", # Число. ID - опроса
	"results":	 # Список. Индексы вопросов и ответы на них
	[					
    	{"question_id_1": "My answer"},                      # Тип вопроса 'Т'-текст. 
    	{"question_id_1": ["answe_id_1"]},                   # Тип вопроса 'O'
    	{"question_id_1": ["answe_id_1","answe_id_2", ...]}, # Тип вопроса 'M'-несколько вариантов
    	...                                                  # question_id - Строка. Индекс вопроса
    	                                                     # answe_id    - Строка. Индекс ответа
	]
}
```
Тело ответа:
```
[
    {
        "id_survey", # Число. ID - опроса
        "user_id",   # Число. ID - пользователя
        "results":   # Список. Вопросы и ответы на них
		[
            {
                "question_type", # Строка. Тип вопроса
                "question_text", # Строка. Текст вопроса
                "answer_text":   # Строка. Ответы на вопрос
                    			 #	Для ответов с выриантов выбора строка вида ["One","Two"]
            }
			...
        ]
    },
    ...
]
```
